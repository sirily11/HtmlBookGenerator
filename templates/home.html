<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'>
    <meta id="my-data" hidden data-name="{{html_contents}}">
    <script src="/static/scripts/core/jquery.min.js"></script>
    <script src="/static/scripts/core/popper.min.js"></script>
    <script src="/static/scripts/bootstrap-material-design.js"></script>
    <script src="/static/scripts/material-kit.js?v=2.0.0"></script>
    <link rel="stylesheet" href="/static/stylesheet/material-kit.css">
    <link rel="stylesheet" href="/static/stylesheet/style.css">
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"/>
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="/static/scripts/turndown.js"></script>
    <link href="/static/stylesheet/style.css" rel="stylesheet" type="text/css"/>
    <link href="/static/stylesheet/w3css.css" rel="stylesheet" type="text/css"/>
    <title>Markdown Editor</title>
</head>
<style>
    .edit-area {
        width: 100%;
        height: 100vh;
        margin-left: 20px;
        font-size: 20px;
        font-family: "微软雅黑";
    }

    p {
        font-size: 20px;
    }

    .loading-bar {
        margin-top: 150px;
    }

</style>
<script>
    $(function ($) {
        $.fn.editableContent = function () {
            return this.html().replace(/<div>/gi, '<br>').replace(/<\/div>/gi, '');
        };
    });
    var html = $('#my-data').data('name');
</script>
<body>
<div>
    {% include 'partition/nav.html' %}
    <div class="loading-bar">
        <div hidden id="progress-bar"
             class="mdl-progress mdl-js-progress mdl-progress__indeterminate"
             style="width: 100%;">

        </div>
    </div>
</div>
<div class="container-fluid">

    <div class="row">
        <div class="col-sm-2">
            {% include 'partition/sidebar.html' %}
        </div>
        <div class="col-sm-10">
            <div class="card">
                <div id="content" class="card-body edit-area" contenteditable="true">

                </div>
            </div>

        </div>
    </div>
</div>
<script src="/static/scripts/app.js"></script>
<script>
    //Get the content of the current clicking
    $('.menu-text').click(function (e) {
        $("#progress-bar").fadeIn(500);
        folder = $(this).parent().attr('id');
        file_name = $(this).text();
        $.getJSON(`/get_content?file_name=${file_name}&folder=${folder}`).done(function (content) {
            $("#progress-bar").fadeOut(500);
            var element = "";
            for (let i = 0; i < content.length; i++) {
                element += content[i]
            }
            $(".edit-area").html(element)
        });

    });

    //create a new folder
    $(document).on("click", "#create", function () {
        $("#sidebar").append(createInputField("folder"));
        $("#folder-set").click(function () {
            var folder_name = $("#name").val();
            $("#sidebar").append(`
            <li class="nav-item">
            <a class="menu-text">${folder_name}</a>
                <button class="mdl-button mdl-js-button mdl-button--icon">
                    <i class="material-icons">
                        add
                    </i>
                </button>
            </li>
            `);
            $.post("/create_folder",
                {
                    "folder": folder_name
                })

        });
    });

    //Create file
    $('.add-btn').click(function () {
        var folder = $(this).parent().parent().attr("id");
        $(`#${folder}`).append(createInputField("file"));
        $("#file-set").click(function () {
            var file_name = $("#name").val();
            console.log(file_name);
            $(`#${folder}`).append(`<a class="nav-link menu-text" href="#">${file_name}</a>`);
            $.post("/create_file",
                {
                    "file_name": file_name.toString(),
                    "folder": folder.toString()
                })

        });
    });

    $(document).on("click", ".inputField-btn", function () {
        $("#inputField").remove();
    });

    //publish to book
    $("#publish-to-book").click(function () {
        $.post("/publish").done(alert("Finished publish"));
    });

    function createInputField(fileOrFolder) {
        html = `<a class="menu-text" id="inputField">
            <div class="row">
                <div class="col-sm-12">
                    <input class="form-control" id="name" placeholder="name">
                </div>
            </div>
           <div class="row">
                <div class="col-sm-6" style="width: auto">
                <button class="inputField-btn mdl-button mdl-js-button mdl-button--icon">
                    <i id="${fileOrFolder}-set" class="material-icons">
                        done
                    </i>
                </button>
                </div>
                <div class="col-sm-6">
                <button class="inputField-btn mdl-button mdl-js-button mdl-button--icon">
                    <i id="cancel" class="material-icons" style="width: auto">
                        clear
                    </i>
                </button>
                </div>
            </div>
        </a>`
        return html
    }

</script>
</body>
</html>